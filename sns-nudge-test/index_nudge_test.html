<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¨¡æ“¬SNSãƒŠãƒƒã‚¸å®Ÿé¨“ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—</title>
  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --muted: #6b7280;
      --primary: #111827;
      --accent: #e53935;
      /* REC èµ¤ */
      --ring: #4b5563;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
      background: var(--bg);
      color: --primary;
      color: var(--primary);
    }

    .container {
      max-width: 760px;
      margin: 24px auto;
      padding: 16px;
    }

    .card {
      background: var(--card);
      border: 1px solid #e5e7eb;
      border-radius: 14px;
      box-shadow: 0 4px 18px rgba(0, 0, 0, 0.04);
      overflow: hidden;
    }

    .header {
      padding: 16px 20px;
      border-bottom: 1px solid #eef0f3;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .title {
      font-size: 16px;
      font-weight: 700;
    }

    .sub {
      color: var(--muted);
      font-size: 12px;
    }

    .body {
      padding: 20px;
    }

    .row {
      margin-bottom: 16px;
    }

    .topic {
      background: #f0f7ff;
      border: 1px solid #dbeafe;
      color: #1e40af;
      padding: 14px;
      border-radius: 12px;
    }

    .input-wrap {
      position: relative;
      margin-top: 12px;
      padding-top: 24px;
    }

    textarea {
      width: 100%;
      min-height: 140px;
      padding: 14px 14px;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      font-size: 14px;
      resize: vertical;
      outline: none;
    }

    textarea:focus {
      border-color: #a5b4fc;
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-top: 12px;
    }

    .muted {
      color: var(--muted);
      font-size: 12px;
    }

    .actions {
      display: flex;
      gap: 10px;
    }

    button {
      appearance: none;
      border: 1px solid #e5e7eb;
      background: #fff;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
    }

    button.primary {
      background: #111827;
      color: #fff;
      border-color: #111827;
    }

    button[disabled] {
      opacity: .5;
      cursor: not-allowed;
    }

    /* ğŸ‘ï¸ ç›®ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæ¬„ å·¦ä¸Šï¼‰ */
    .eye-icon {
      position: absolute;
      top: -6px;
      left: 10px;
      right: auto;
      font-size: 22px;
      opacity: 0.85;
      animation: blink 3s infinite;
      user-select: none;
      pointer-events: none;
    }

    @keyframes blink {

      0%,
      90%,
      100% {
        transform: scale(1);
        opacity: 0.85
      }

      95% {
        transform: scale(0.92);
        opacity: 0.35
      }
    }

    /* RECãƒãƒƒã‚¸ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆæ¬„ å·¦ä¸Šï¼šEYE ã®å³æ¨ªã‚ãŸã‚Šï¼‰ */
    .rec {
      position: absolute;
      top: -4px;
      left: 14px;
      right: auto;
      color: #E53935;
      font-weight: 800;
      letter-spacing: .5px;
      z-index: 10;
      animation: recpulse 1s linear infinite;
      pointer-events: none;
      font-size: 16px;
      transform: scale(1.2);
    }

    @keyframes recpulse {

      0%,
      100% {
        opacity: 1;
        transform: scale(1);
      }

      50% {
        opacity: .25;
        transform: scale(.96);
      }
    }

    /* ç¢ºèªç”»é¢ã®ãƒ«ãƒ¼ãƒˆã¯ relative æ¨å¥¨ï¼ˆçµ¶å¯¾é…ç½®ã®åŸºæº–ï¼‰ */
    #screen-confirm {
      position: relative;
    }

    /* ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼é¡é¢¨ã®æ  */
    .mirror {
      background: linear-gradient(180deg, #fff, #eef2f7);
      border: 1px solid #d1d5db;
      border-radius: 12px;
      padding: 16px;
      filter: brightness(.98);
    }

    .mirror .user {
      font-weight: 700;
      margin-bottom: 6px;
    }

    .mirror .text {
      font-style: italic;
      color: #1f2937;
      white-space: pre-wrap;
      word-break: break-word;
    }

    /* â³ ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³ãƒªãƒ³ã‚° */
    .cooldown {
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .ring {
      width: 20px;
      height: 20px;
      border: 3px solid #cbd5e1;
      border-top-color: var(--ring);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .footer {
      padding: 16px 20px;
      border-top: 1px solid #eef0f3;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .notice {
      color: var(--muted);
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* ãƒšãƒ¼ã‚¸åˆ‡æ›¿ã®ãŸã‚ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .screen {
      display: none;
      position: relative;
    }

    .screen.active {
      display: block;
    }

    .post-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 8px;
    }

    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #38bdf8, #22c55e);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 16px;
    }

    .avatar-label {
      display: flex;
      flex-direction: column;
      font-size: 13px;
    }

    .avatar-label .name {
      font-weight: 600;
    }

    .avatar-label .handle {
      color: var(--muted);
      font-size: 12px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="title">æ¨¡æ“¬SNSãƒŠãƒƒã‚¸å®Ÿé¨“</div>
        <div class="sub" id="condLabel" style="display:none;">æ¡ä»¶: â€”</div>
      </div>

      <div class="body">
        <!-- èª¬æ˜ãƒ»åŒæ„ç”»é¢ï¼ˆintroï¼‰ -->
        <section id="screen-intro" class="screen active">
          <div class="row">
            <h3>å®Ÿé¨“ã®èª¬æ˜</h3>
            <p class="muted">
              ã“ã®ãƒšãƒ¼ã‚¸ã¯ã€ã€ŒSNSã®æŠ•ç¨¿ç”»é¢ã«ãŠã‘ã‚‹è¡¨ç¤ºãŒã€ã‚³ãƒ¡ãƒ³ãƒˆã®æ›¸ãæ–¹ã«ã©ã®ã‚ˆã†ãªå½±éŸ¿ã‚’ä¸ãˆã‚‹ã‹ã€ã‚’èª¿ã¹ã‚‹
              å¤§å­¦ã®ç ”ç©¶ç”¨ã®æ¨¡æ“¬SNSç”»é¢ã§ã™ã€‚
            </p>
            <p class="muted">
              ã“ã‚Œã‹ã‚‰ã€ã‚ã‚‹æŠ•ç¨¿ã¨ãã‚Œã«å¯¾ã™ã‚‹è¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆã‚’èª­ã‚“ã ã†ãˆã§ã€
              ã‚ãªãŸè‡ªèº«ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’1ã¤å…¥åŠ›ã—ã¦ã„ãŸã ãã¾ã™ã€‚
              ãã®å¾Œã€çŸ­ã„ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«å›ç­”ã—ã¦ã„ãŸã ãã¾ã™ã€‚
            </p>
            <p class="muted">
              å…¥åŠ›ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆå†…å®¹ã‚„ã€å…¥åŠ›ã«ã‹ã‹ã£ãŸæ™‚é–“ãªã©ã®æ“ä½œãƒ­ã‚°ã€
              ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®å›ç­”ã¯ã€<strong>ã™ã¹ã¦åŒ¿åã®IDã¨ã¨ã‚‚ã«è¨˜éŒ²ã•ã‚Œã€ç ”ç©¶ç›®çš„ã®ã¿ã«åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚</strong>
              å€‹äººãŒç‰¹å®šã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
            </p>
            <p class="muted">
              å‚åŠ ã¯ä»»æ„ã§ã‚ã‚Šã€é€”ä¸­ã§ä¸­æ­¢ã—ã¦ã„ãŸã ã„ã¦ã‚‚ã‹ã¾ã„ã¾ã›ã‚“ã€‚
              ãªãŠã€åˆ†æã®éƒ½åˆä¸Šã€ã‚³ãƒ¡ãƒ³ãƒˆã¯ä¸€è¨€ã§ã¯ãªãã€
              ã§ãã‚‹ã ã‘ç†ç”±ã‚„è€ƒãˆã‚‚å«ã‚ã¦æ›¸ã„ã¦ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
            </p>
            <p class="muted">
              ä¸Šè¨˜ã®å†…å®¹ã«åŒæ„ã—ã¦ã€å®Ÿé¨“ã«å‚åŠ ã—ã¦ã‚‚ã‚ˆã‚ã—ã‘ã‚Œã°ã€
              ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦é€²ã‚“ã§ãã ã•ã„ã€‚
            </p>
          </div>
          <div class="toolbar">
            <div class="muted">åŒæ„ã—ãªã„å ´åˆã¯ã€ã“ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’é–‰ã˜ã¦ãã ã•ã„ã€‚</div>
            <div class="actions">
              <button id="startBtn" class="primary">åŒæ„ã—ã¦å®Ÿé¨“ã‚’å§‹ã‚ã‚‹</button>
            </div>
          </div>
        </section>

        <!-- æŠ•ç¨¿ç”»é¢ï¼ˆcomposeï¼‰ -->
        <section id="screen-compose" class="screen">
          <div class="row topic" id="topic">
            <strong>æŠ•ç¨¿</strong><br />
            <div class="post-header">
              <div class="avatar">MC</div>
              <div class="avatar-label">
                <span class="name">ç››å²¡ã‚·ãƒ†ã‚£ãƒ©ã‚¤ãƒ•</span>
                <span class="handle">@morioka_city_life</span>
              </div>
            </div>
            <blockquote style="margin:8px 0; padding:8px 12px; background:#f9fafb; border-left:4px solid #3b82f6;">
              ä»Šæ—¥ã‚‚å¤§å­¦ã®å‰ã§å¸ã£ã¦ã‚‹äººã„ãŸã‘ã©ã€åˆ¥ã«å¤–ãªã‚“ã ã‹ã‚‰è‰¯ããªã„ï¼Ÿ<br />
              å…¨é¢ç¦ç…™ã¨ã‹å³ã—ã™ãã‚‹ã¨æ€ã†ã‚“ã ã‘ã©ã€‚<br />
              ã¡ã‚‡ã£ã¨å¸ã£ãŸãã‚‰ã„ã§èª°ã‚‚å›°ã‚‰ãªã„ã§ã—ã‚‡ã€‚
            </blockquote>

            <p><strong>å…ˆè¡Œè¿”ä¿¡ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆæ”»æ’ƒçš„ãªä¾‹ï¼‰</strong></p>
            <div style="margin-left:1em;">
              <p><strong>è¿”ä¿¡ï¼‘ï¼š</strong>@xx_user01<br />
                å¤–ã§å¸ã†ã®ã¯å‹æ‰‹ã ã‚ã€‚æ–‡å¥è¨€ã£ã¦ã‚‹å¥´ãŒç¥çµŒè³ªã™ãã‚‹ã‚ã€‚</p>

              <p><strong>è¿”ä¿¡ï¼’ï¼ˆã‚ˆã‚Šå¼·ã„æ”»æ’ƒï¼‰ï¼š</strong><br />
                ç¦ç…™å¨ã»ã‚“ã¨é¢å€’ãã•ã„ã€‚è‡ªåˆ†ã®æ„è¦‹ã‚’æŠ¼ã—ã¤ã‘ã‚‹ãªã£ã¦ã®ã€‚</p>
            </div>
          </div>

          <div class="row input-wrap" id="composeWrap">
            <!-- ğŸ‘ï¸ ç›®ã‚¢ã‚¤ã‚³ãƒ³ã¯æ¡ä»¶ã«ã‚ˆã£ã¦æŒ¿å…¥ -->
            <div class="rec" id="recBadge" style="display:none;">â— REC</div>
            <textarea id="ta" placeholder="ã“ã“ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›"></textarea>
          </div>
          <div class="toolbar">
            <div class="muted" id="charCount">0 æ–‡å­—</div>
            <div class="actions">
              <button id="nextBtn" class="primary">æ¬¡ã¸</button>
            </div>
          </div>
        </section>

        <!-- ç¢ºèªç”»é¢ï¼ˆconfirmï¼‰ -->
        <section id="screen-confirm" class="screen">
          <div class="row mirror">
            <div class="user" id="userName">ã‚ãªãŸï¼ˆ@participantï¼‰</div>
            <div class="text" id="mirrorText"></div>
          </div>
          <div class="row">
            <div class="muted" id="cooldownArea" style="display:none;">
              <span class="cooldown"><span class="ring"></span>é€ä¿¡æº–å‚™ä¸­â€¦</span>
            </div>
          </div>
          <div class="toolbar">
            <div class="muted">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèªã—ã¦ã€å¿…è¦ãªã‚‰ä¿®æ­£ã—ã¦ãã ã•ã„ã€‚</div>
            <div class="actions">
              <button id="backBtn">æˆ»ã‚‹</button>
              <button id="sendBtn" class="primary" disabled>é€ä¿¡</button>
            </div>
          </div>
        </section>

        <!-- å®Œäº†ç”»é¢ï¼ˆcompleteï¼‰ -->
        <section id="screen-complete" class="screen">
          <div class="row">
            <h3>é€ä¿¡ãŒå®Œäº†ã—ã¾ã—ãŸã€‚</h3>
            <p class="muted">ã”å”åŠ›ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚ç¶šã‘ã¦äº‹å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ãŠç­”ãˆãã ã•ã„ï¼ˆåˆ¥ãƒ•ã‚©ãƒ¼ãƒ ï¼‰ã€‚</p>
            <p class="muted">
              ã‚ãªãŸã®å‚åŠ è€…IDï¼š<code id="pidComplete"></code><br>
              äº‹å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã®æœ€åˆã®è³ªå•æ¬„ã«ã€ã“ã®IDã‚’ãã®ã¾ã¾å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
            </p>
            <p><a id="surveyLink" href="https://forms.gle/vJFaLeMnXb3LUREw8" target="_blank">äº‹å¾Œã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚’é–‹ã</a></p>
            <pre id="debugOut"
              style="display:none; white-space:pre-wrap; background:#0b1220; color:#cbd5e1; padding:12px; border-radius:10px; font-size:12px; overflow:auto;"></pre>
          </div>
        </section>
      </div>

      <div class="footer">
        <div class="notice">ğŸ”’ æœ¬å®Ÿé¨“ã®ãƒ‡ãƒ¼ã‚¿ã¯å­¦è¡“ç›®çš„ã§åŒ¿åä¿å­˜ã•ã‚Œã¾ã™ã€‚</div>
        <div class="muted" id="pid">â€”</div>
      </div>
    </div>
  </div>

  <script>
    // ====== æ¡ä»¶æ±ºå®šï¼ˆãƒ©ãƒ³ãƒ€ãƒ ï¼‰ ======
 
    let COND = sessionStorage.getItem('exp_cond');
    if (!COND) {
      const conds = ['CTRL', 'EYE', 'REC']; // ãƒŠãƒƒã‚¸ãªã— / ç›® / REC
      const idx = Math.floor(Math.random() * conds.length);
      COND = conds[idx];
      sessionStorage.setItem('exp_cond', COND);
    }

    // ====== å‚åŠ è€…ID ======
    const pid = (() => {
      const k = 'exp_pid';
      let v = sessionStorage.getItem(k);
      if (!v) {
        v = 'p' + Math.random().toString(36).slice(2, 10);
        sessionStorage.setItem(k, v);
      }
      return v;
    })();

    // ====== ãƒ­ã‚° ======
    const log = {
      pid,
      cond: COND,
      ua: navigator.userAgent,
      openAt: Date.now(),
      typeStart: null,
      previewOpen: null,
      submitAt: null,
      canceled: false,
      backspaceCount: 0,
      delCount: 0,
      pasteCount: 0,
      deltaChars: 0,
      lenAtSubmit: 0,
    };

    // ====== è¦ç´ å‚ç…§ ======
    const screenIntro = document.getElementById('screen-intro');
    const screenCompose = document.getElementById('screen-compose');
    const screenConfirm = document.getElementById('screen-confirm');
    const screenComplete = document.getElementById('screen-complete');
    const condLabel = document.getElementById('condLabel');
    const composeWrap = document.getElementById('composeWrap');
    const ta = document.getElementById('ta');
    const charCount = document.getElementById('charCount');
    const nextBtn = document.getElementById('nextBtn');
    const backBtn = document.getElementById('backBtn');
    const sendBtn = document.getElementById('sendBtn');
    const recBadge = document.getElementById('recBadge');
    const mirrorText = document.getElementById('mirrorText');
    const cooldownArea = document.getElementById('cooldownArea');
    const pidFoot = document.getElementById('pid');
    const pidComplete = document.getElementById('pidComplete');
    const debugOut = document.getElementById('debugOut');
    const surveyLink = document.getElementById('surveyLink');
    const startBtn = document.getElementById('startBtn');

    // èª¬æ˜â†’æŠ•ç¨¿ç”»é¢ã¸
    startBtn.addEventListener('click', () => {
      go('compose');
      //ta.focus();
    });

    condLabel.textContent = `æ¡ä»¶: ${COND}`;
    pidFoot.textContent = `ID: ${pid}`;
    pidComplete.textContent = pid;

    // ============================
    // ğŸ‘ï¸ EYE & ğŸ”´ REC è¡¨ç¤ºåˆ¶å¾¡
    // ============================
    let eyeIcon = null;
    let eyeShown = false;
    if (COND === 'EYE' || COND === 'EYE_REC') {
      eyeIcon = document.createElement('div');
      eyeIcon.className = 'eye-icon';
      eyeIcon.textContent = 'ğŸ‘ï¸';
    }

    // RECãƒãƒ¼ã‚¯ï¼ˆåˆæœŸéè¡¨ç¤ºï¼‰
    recBadge.style.display = 'none';
    let recShown = false;

    function showNudgesIfNeeded() {
      // EYE
      if (eyeIcon && !eyeShown) {
        composeWrap.appendChild(eyeIcon);
        eyeShown = true;
      }
      // RECï¼ˆRECã¾ãŸã¯EYE_RECã®å ´åˆï¼‰
      if ((COND === 'REC' || COND === 'EYE_REC') && !recShown) {
        recBadge.style.display = 'block';
        recShown = true;
      }
    }

    // textarea ã®ã‚¤ãƒ™ãƒ³ãƒˆã§ãƒŠãƒƒã‚¸ç™ºç«ï¼ˆãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ï¼‰
    ta.addEventListener('focus', showNudgesIfNeeded);

    // ============================
    // å…¥åŠ›ãƒ­ã‚°
    // ============================
    let prevLen = 0;
    ta.addEventListener('input', () => {
      const len = ta.value.length;
      charCount.textContent = `${len} æ–‡å­—`;
      if (log.typeStart === null && len > 0) log.typeStart = Date.now();
      const diff = len - prevLen;
      log.deltaChars += diff;
      prevLen = len;
    });

    ta.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace') log.backspaceCount++;
      if (e.key === 'Delete') log.delCount++;
      if (e.ctrlKey && e.key.toLowerCase() === 'v') log.pasteCount++;
    });

    // ============================
    // ç”»é¢é·ç§»
    // ============================
    function go(name) {
      screenIntro.classList.remove('active');
      screenCompose.classList.remove('active');
      screenConfirm.classList.remove('active');
      screenComplete.classList.remove('active');

      if (name === 'intro') screenIntro.classList.add('active');
      if (name === 'compose') screenCompose.classList.add('active');
      if (name === 'confirm') screenConfirm.classList.add('active');
      if (name === 'complete') screenComplete.classList.add('active');
    }

    nextBtn.addEventListener('click', () => {
      mirrorText.textContent = ta.value.trim();
      if (!mirrorText.textContent) {
        ta.focus();
        return;
      }

      log.previewOpen = Date.now();

      // ã‚¯ãƒ¼ãƒ«ãƒ€ã‚¦ãƒ³
      cooldownArea.style.display = 'inline-block';
      sendBtn.disabled = true;
      setTimeout(() => {
        sendBtn.disabled = false;
        cooldownArea.style.display = 'none';
      }, 1500);

      go('confirm');
    });

    backBtn.addEventListener('click', () => {
      log.canceled = true;
      go('compose');
      ta.focus();
    });

    // ============================
    // é€ä¿¡
    // ============================
    sendBtn.addEventListener('click', async () => {
      log.submitAt = Date.now();
      log.lenAtSubmit = ta.value.length;

      const payload = { ...log, text: ta.value, token: 'NUDGE_2025_SECRET' };
      debugOut.textContent = JSON.stringify(payload, null, 2);

      const WEBHOOK_URL =
        'https://script.google.com/macros/s/AKfycby0Nfm5TVHFYAi6eTrd_e-1kH-UFa1nrOSfqqDfEVfvP5yC-uF2Nbh2BoRN3_VyJVUH/exec';

      try {
        await fetch(WEBHOOK_URL, {
          method: 'POST',
          mode: 'no-cors',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify(payload)
        });
      } catch (e) {
        console.error(e);
      }

      go('complete');
    });
  </script>
</body>

</html>